<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ó–∞–º–µ—Ç–∫–∏</title>
</head>
<style>
        body {
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(135deg, #1e1e2f, #3a3a5a);
            margin: 0;
            padding: 20px;
            color: #eaeaea;
        }

       .container {
        max-width: 800px;
        margin: auto;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 4px 30px rgba(0, 0, 0, 0.2);
        transition: box-shadow 0.3s ease;
    }

    .container:hover {
        box-shadow: 0 8px 50px rgba(0, 0, 0, 0.3);
    }

    h1, h2 {
        text-align: center;
        color: #00bcd4;
        text-shadow: 0 0 10px rgba(0, 188, 212, 0.5);
    }

    textarea, input {
    width: 100%;
    max-width: 100%;
    margin-bottom: 10px;
    border: none;
    border-radius: 8px;
    padding: 15px;
    font-size: 16px;
    background: rgba(255, 255, 255, 0.2);
    color: #eaeaea;
    transition: background-color 0.3s ease;
    box-sizing: border-box; /* ‚¨ÖÔ∏è –ö–ª—é—á–µ–≤–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ */
    }

    textarea:focus, input:focus {
    background: rgba(255, 255, 255, 0.3);
    outline: none;
    box-sizing: border-box; /* –ù–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π */
    }



    button {
        width: 100%;
        padding: 15px;
        background: linear-gradient(90deg, #00bcd4, #3f51b5);
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        transition: background 0.3s ease, transform 0.2s ease;
        box-shadow: 0 4px 15px rgba(0, 188, 212, 0.3);
    }

    button:hover {
        background: linear-gradient(90deg, #3f51b5, #00bcd4);
        transform: translateY(-2px);
    }

    .note {
        background: rgba(255, 255, 255, 0.15);
        padding: 15px;
        margin: 10px 0;
        border-radius: 8px;
        box-shadow: 0 2px 20px rgba(0, 0, 0, 0.2);
    }

    .tag-group {
        margin-top: 20px;
        border-radius: 8px;
        padding: 10px;
        background: rgba(255, 255, 255, 0.1);
        box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
    }

    .tag-group h3 {
        margin: 0;
        color: #00bcd4;
        text-shadow: 0 0 5px rgba(0, 188, 212, 0.5);
    }

    svg {
        border: 1px solid #ccc;
        margin-top: 20px;
    }

    .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        background: linear-gradient(90deg, #4CAF50, #45a049);
        color: white;
        padding: 15px 25px;
        border-radius: 8px;
        box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        z-index: 1000;
        transform: translateX(150%);
        transition: transform 0.3s ease-in-out;
        font-weight: bold;
    }

    .notification.show {
        transform: translateX(0);
    }

    .notification.hide {
        transform: translateX(150%);
    }
</style>
<body>
    <div class="container">
        <h1>–ú–æ–∏ –ó–∞–º–µ—Ç–∫–∏</h1>
        <input type="text" id="noteTitle" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫ –∑–∞–º–µ—Ç–∫–∏..." />
        <textarea id="noteInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à—É –∑–∞–º–µ—Ç–∫—É..."></textarea>
        <input type="text" id="tagsInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–≥–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)" />
        <button id="addNoteButton">–î–æ–±–∞–≤–∏—Ç—å –ó–∞–º–µ—Ç–∫—É</button>


        <div style="height: 30px;"></div>
        <div style="text-align: center; margin-bottom: 20px;">
            <a href="/all-notes" style="background: #6c757d; color: white; padding: 10px 20px;
                text-decoration: none; border-radius: 5px; display: inline-block;">
                    –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –∑–∞–º–µ—Ç–∫–∏
            </a>
        </div>

        <h2>–ì—Ä–∞—Ñ –∑–∞–º–µ—Ç–æ–∫ (ü§î)</h2>
        <div id="notesList">
            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –≥—Ä–∞—Ñ–∞...</div>
        </div>
    </div>

    <script>
        const DEFAULT_USER_ID = 1;

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–º–µ—Ç–æ–∫ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        //document.addEventListener('DOMContentLoaded', function() {
        //    loadNotes();
        //});

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–º–µ—Ç–∫–∏
        document.getElementById('addNoteButton').addEventListener('click', function() {
            const noteTitle = document.getElementById('noteTitle').value.trim();
            const noteContent = document.getElementById('noteInput').value.trim();
            const tagsText = document.getElementById('tagsInput').value.trim();

            if (!noteTitle || !noteContent) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏!');
                return;
            }

            createNote(noteTitle, noteContent, tagsText);
        });

        // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–º–µ—Ç–æ–∫ —Å —Å–µ—Ä–≤–µ—Ä–∞
        async function loadNotes() {
            try {
                const response = await fetch('/api/notes');
                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–º–µ—Ç–æ–∫');
                }

                const notes = await response.json();
                displayNotes(notes);
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('notesList').innerHTML =
                    '<div class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–º–µ—Ç–æ–∫: ' + error.message + '</div>';
            }
        }

        // –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π –∑–∞–º–µ—Ç–∫–∏
        async function createNote(title, content, tags) {
        try {
            const response = await fetch('/api/notes', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    user_id: DEFAULT_USER_ID,
                    title: title,
                    content: content,
                    tags: tags.split(',').map(tag => tag.trim())
                })
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || '–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–º–µ—Ç–∫–∏');
            }

            // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
            document.getElementById('noteTitle').value = '';
            document.getElementById('noteInput').value = '';
            document.getElementById('tagsInput').value = '';

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            showNotification();

        } catch (error) {
            console.error('Error:', error);
            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–º–µ—Ç–∫–∏: ' + error.message);
        }
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    function showNotification() {
        const notification = document.getElementById('notification');
        notification.classList.add('show');

        setTimeout(() => {
            notification.classList.remove('show');
            notification.classList.add('hide');

            setTimeout(() => {
                notification.classList.remove('hide');
            }, 300);
        }, 3000);
    }

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–∞–º–µ—Ç–æ–∫
        function displayNotes(notes) {
            const notesList = document.getElementById('notesList');

            if (notes.length === 0) {
                notesList.innerHTML = '<div class="loading">–ó–∞–º–µ—Ç–æ–∫ –ø–æ–∫–∞ –Ω–µ—Ç. –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é!</div>';
                return;
            }

            let html = '';

            notes.forEach(note => {
                html += `
                <div class="note">
                    <strong>${escapeHtml(note.title)}</strong><br>
                    ${escapeHtml(note.content)}<br>
                    ${note.tags ? '–¢–µ–≥–∏: ' + escapeHtml(note.tags) : ''}<br>
                    <small>–°–æ–∑–¥–∞–Ω–æ: ${new Date(note.created_at).toLocaleString('ru-RU')}</small>
                </div>`;
            });

            notesList.innerHTML = html;
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è HTML
        function escapeHtml(unsafe) {
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;")
                .replace(/\n/g, '<br>');
        }
    </script>

    <div id="notification" class="notification">
         –ó–∞–º–µ—Ç–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!
    </div>

</body>
</html>